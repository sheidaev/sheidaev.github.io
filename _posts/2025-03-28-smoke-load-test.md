---
layout: post
title: "Smoke load tests - перший, обовʼязковий крок"
date: 2025-03-28 20:00:00 +0530
tags: [testing, k6, performance, load-testing, smoke load test ]
---

### Що таке Smoke load test ?

**Smoke load test** - це тестування з мінімальним навантаженням, заради того щоб переконатись що твій скрипт працює і система може переварити хочаб одного юзера.

### Коли запускати Smoke load test ?

- Створюється/оновлюється тестовий скрипт
- Генератор навантаження, або система для тестування переїхали на інші сервери
- Треба протестувати механізм збору базових метрік системи
- Треба виконати синтетичний тест для моніторингу продакшену 

### Основні принципи

**1. Швидкий і слабкий, як секс твоєї з колишнім**
Ваша задача перевірити що все працює, ця перевірка повинна бути непомітною і швидкою. 
Навантаження: 3-5 rps, або 1-2 VUs, саме то. 
Тривалість: від 30 секунд до 2 хвилин. 

**2. Не забувай про прелюдію**
Якщо, при запуску на холодну системі потрібно розігрітись, запустити сервіси і завантажити буфери, ок, дай їй цю можливість. 
Зазвичай 1 rps/VU і 15-20 секунд - більш ніж достатньо.

Тобто ідеальний smoke тест, має вигляд:
1 VU - 15 секунд - розігрів 
2 VU - 1 хвилину - тест

<div style="text-align: center;">
    <img src="/assets/images/smoke-load-test/smoke-load-test.png" alt="Smoke load test">
</div>

### Smoke load test для k6

```javascript
import http from 'k6/http';
import { check, sleep } from 'k6';

export const options = {
  stages: [
    { duration: '15s', target: 1 }, // Прогрів: 1 VU, 15 секунд (прибрати, якщо прогрів не потрібен)
    { duration: '1m', target: 2 },  // Тест: 2 VU, 1 хвилина
  ],
};

export default () => {
  const urlRes = http.get('https://sheidaev.com/');
  check(urlRes, { 'status returned 200': (r) => r.status == 200 })
};
```

### Аналіз результатів

1. Шукай і виправляй помилки в скрипті. 
2. Шукай і виправляй помилки в оточенні теста:
    - генартор навантаження 
    - мережа 
    - истема що тестується
3. Переконайся що твій скрипт справді створює навантаження
    - Залогуй запити і відповіді. 
    - Провалідуй їх, очима. 

Якщо твій smoke test показує нуль помилок і результати продуктивності здаються прийнятними, можна переходити до інших типів тестів.

### Висновок

Це обов'язковий перший крок у будь-якому процесі навантажувального тестування.
Не пропускай цей етап - він заощадить тобі купу часу на налагодження скриптів пізніше.
